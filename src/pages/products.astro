---
import BaseLayout from '../layouts/BaseLayout.astro';
import NewsletterCTA from '../components/NewsletterCTA.astro';
import ProductHero from '../components/ProductHero.astro';
import TrustNote from '../components/TrustNote.astro';
import ProductCategorySection from '../components/ProductCategorySection.astro';
import ProductTableOfContents from '../components/ProductTableOfContents.astro';
import { productCategories } from '../data/products';

// Filter out categories with no products
const visibleCategories = productCategories.filter(cat => cat.products.length > 0);

// For each category, show only top 4 rated products
const categoriesWithTopProducts = visibleCategories.map(category => ({
  ...category,
  totalCount: category.products.length,
  products: [...category.products]
    .sort((a, b) => b.rating - a.rating)
    .slice(0, 4)
}));
---

<BaseLayout
  title="Recommended Pet Products | Pet Care Blog"
  description="Discover our top-rated pet products, hand-picked by our team of experts. From dog food to cat toys, find the best for your furry friends."
>
  <ProductHero />
  <TrustNote />
  
  <!-- Two-column layout: TOC sidebar + content -->
  <div class="container-blog py-8">
    <div class="flex flex-col lg:flex-row gap-8 lg:gap-12">
      <!-- Sidebar with TOC (desktop) -->
      <aside class="w-full lg:w-72 order-2 lg:order-1 flex-shrink-0">
        <ProductTableOfContents categories={categoriesWithTopProducts} />
      </aside>

      <!-- Main content with sections -->
      <main class="flex-1 min-w-0 order-1 lg:order-2">
        {categoriesWithTopProducts.map(category => (
          <div id={`section-${category.id}`} class="scroll-mt-8">
            <ProductCategorySection
              id={category.id}
              title={category.title}
              icon={category.icon}
              products={category.products}
              alternate={category.alternate}
              showViewAll={true}
              totalCount={category.totalCount}
            />
          </div>
        ))}
      </main>
    </div>
  </div>
  
  <section class="section-padding" style="background-color: var(--color-alabaster);">
    <div class="container-blog max-w-4xl">
      <NewsletterCTA />
    </div>
  </section>
</BaseLayout>
